{"version":3,"sources":["../browser/src/platform/PlatformTools.ts"],"names":[],"mappings":"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","file":"PlatformTools.js","sourcesContent":["import * as path from \"path\"\r\nimport * as fs from \"fs\"\r\nimport dotenv from \"dotenv\"\r\nimport chalk from \"chalk\"\r\nimport { highlight, Theme } from \"cli-highlight\"\r\n\r\nexport { ReadStream } from \"fs\"\r\nexport { EventEmitter } from \"events\"\r\nexport { Readable, Writable } from \"stream\"\r\n\r\n/**\r\n * Platform-specific tools.\r\n */\r\nexport class PlatformTools {\r\n    /**\r\n     * Type of the currently running platform.\r\n     */\r\n    static type: \"browser\" | \"node\" = \"node\"\r\n\r\n    /**\r\n     * Gets global variable where global stuff can be stored.\r\n     */\r\n    static getGlobalVariable(): any {\r\n        return global\r\n    }\r\n\r\n    /**\r\n     * Loads (\"require\"-s) given file or package.\r\n     * This operation only supports on node platform\r\n     */\r\n    static load(name: string): any {\r\n        // if name is not absolute or relative, then try to load package from the node_modules of the directory we are currently in\r\n        // this is useful when we are using typeorm package globally installed and it accesses drivers\r\n        // that are not installed globally\r\n\r\n        try {\r\n            // switch case to explicit require statements for webpack compatibility.\r\n            switch (name) {\r\n                /**\r\n                 * spanner\r\n                 */\r\n                case \"spanner\":\r\n                    return require(\"@google-cloud/spanner\")\r\n\r\n                /**\r\n                 * mongodb\r\n                 */\r\n                case \"mongodb\":\r\n                    return require(\"mongodb\")\r\n\r\n                /**\r\n                 * hana\r\n                 */\r\n                case \"@sap/hana-client\":\r\n                    return require(\"@sap/hana-client\")\r\n\r\n                case \"hdb-pool\":\r\n                    return require(\"hdb-pool\")\r\n\r\n                /**\r\n                 * mysql\r\n                 */\r\n                case \"mysql\":\r\n                    return require(\"mysql\")\r\n\r\n                case \"mysql2\":\r\n                    return require(\"mysql2\")\r\n\r\n                /**\r\n                 * oracle\r\n                 */\r\n                case \"oracledb\":\r\n                    return require(\"oracledb\")\r\n\r\n                /**\r\n                 * postgres\r\n                 */\r\n                case \"pg\":\r\n                    return require(\"pg\")\r\n\r\n                case \"pg-native\":\r\n                    return require(\"pg-native\")\r\n\r\n                case \"pg-query-stream\":\r\n                    return require(\"pg-query-stream\")\r\n\r\n                case \"typeorm-aurora-data-api-driver\":\r\n                    return require(\"typeorm-aurora-data-api-driver\")\r\n\r\n                /**\r\n                 * redis\r\n                 */\r\n                case \"redis\":\r\n                    return require(\"redis\")\r\n\r\n                case \"ioredis\":\r\n                    return require(\"ioredis\")\r\n\r\n                /**\r\n                 * better-sqlite3\r\n                 */\r\n                case \"better-sqlite3\":\r\n                    return require(\"better-sqlite3\")\r\n\r\n                /**\r\n                 * sqlite\r\n                 */\r\n                case \"sqlite3\":\r\n                    return require(\"sqlite3\")\r\n\r\n                /**\r\n                 * sql.js\r\n                 */\r\n                case \"sql.js\":\r\n                    return require(\"sql.js\")\r\n\r\n                /**\r\n                 * sqlserver\r\n                 */\r\n                case \"mssql\":\r\n                    return require(\"mssql\")\r\n\r\n                /**\r\n                 * react-native-sqlite\r\n                 */\r\n                case \"react-native-sqlite-storage\":\r\n                    return require(\"react-native-sqlite-storage\")\r\n            }\r\n        } catch (err) {\r\n            return require(path.resolve(\r\n                process.cwd() + \"/node_modules/\" + name,\r\n            ))\r\n        }\r\n\r\n        // If nothing above matched and we get here, the package was not listed within PlatformTools\r\n        // and is an Invalid Package.  To make it explicit that this is NOT the intended use case for\r\n        // PlatformTools.load - it's not just a way to replace `require` all willy-nilly - let's throw\r\n        // an error.\r\n        throw new TypeError(`Invalid Package for PlatformTools.load: ${name}`)\r\n    }\r\n\r\n    /**\r\n     * Normalizes given path. Does \"path.normalize\" and replaces backslashes with forward slashes on Windows.\r\n     */\r\n    static pathNormalize(pathStr: string): string {\r\n        let normalizedPath = path.normalize(pathStr)\r\n        if (process.platform === \"win32\")\r\n            normalizedPath = normalizedPath.replace(/\\\\/g, \"/\")\r\n        return normalizedPath\r\n    }\r\n\r\n    /**\r\n     * Gets file extension. Does \"path.extname\".\r\n     */\r\n    static pathExtname(pathStr: string): string {\r\n        return path.extname(pathStr)\r\n    }\r\n\r\n    /**\r\n     * Resolved given path. Does \"path.resolve\".\r\n     */\r\n    static pathResolve(pathStr: string): string {\r\n        return path.resolve(pathStr)\r\n    }\r\n\r\n    /**\r\n     * Synchronously checks if file exist. Does \"fs.existsSync\".\r\n     */\r\n    static fileExist(pathStr: string): boolean {\r\n        return fs.existsSync(pathStr)\r\n    }\r\n\r\n    static readFileSync(filename: string): Buffer {\r\n        return fs.readFileSync(filename)\r\n    }\r\n\r\n    static appendFileSync(filename: string, data: any): void {\r\n        fs.appendFileSync(filename, data)\r\n    }\r\n\r\n    static async writeFile(path: string, data: any): Promise<void> {\r\n        return new Promise<void>((ok, fail) => {\r\n            fs.writeFile(path, data, (err) => {\r\n                if (err) fail(err)\r\n                ok()\r\n            })\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Loads a dotenv file into the environment variables.\r\n     *\r\n     * @param path The file to load as a dotenv configuration\r\n     */\r\n    static dotenv(pathStr: string): void {\r\n        dotenv.config({ path: pathStr })\r\n    }\r\n\r\n    /**\r\n     * Gets environment variable.\r\n     */\r\n    static getEnvVariable(name: string): any {\r\n        return process.env[name]\r\n    }\r\n\r\n    /**\r\n     * Highlights sql string to be print in the console.\r\n     */\r\n    static highlightSql(sql: string) {\r\n        const theme: Theme = {\r\n            keyword: chalk.blueBright,\r\n            literal: chalk.blueBright,\r\n            string: chalk.white,\r\n            type: chalk.magentaBright,\r\n            built_in: chalk.magentaBright,\r\n            comment: chalk.gray,\r\n        }\r\n        return highlight(sql, { theme: theme, language: \"sql\" })\r\n    }\r\n\r\n    /**\r\n     * Highlights json string to be print in the console.\r\n     */\r\n    static highlightJson(json: string) {\r\n        return highlight(json, { language: \"json\" })\r\n    }\r\n\r\n    /**\r\n     * Logging functions needed by AdvancedConsoleLogger\r\n     */\r\n    static logInfo(prefix: string, info: any) {\r\n        console.log(chalk.gray.underline(prefix), info)\r\n    }\r\n\r\n    static logError(prefix: string, error: any) {\r\n        console.log(chalk.underline.red(prefix), error)\r\n    }\r\n\r\n    static logWarn(prefix: string, warning: any) {\r\n        console.log(chalk.underline.yellow(prefix), warning)\r\n    }\r\n\r\n    static log(message: string) {\r\n        console.log(chalk.underline(message))\r\n    }\r\n\r\n    static info(info: any) {\r\n        return chalk.gray(info)\r\n    }\r\n\r\n    static error(error: any) {\r\n        return chalk.red(error)\r\n    }\r\n\r\n    static warn(message: string) {\r\n        return chalk.yellow(message)\r\n    }\r\n\r\n    static logCmdErr(prefix: string, err?: any) {\r\n        console.log(chalk.black.bgRed(prefix))\r\n        if (err) console.error(err)\r\n    }\r\n}\r\n"],"sourceRoot":".."}